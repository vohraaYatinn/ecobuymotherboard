(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,48092,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(22016),a=e.i(70065),n=e.i(67881),i=e.i(94179),d=e.i(62870),l=e.i(10708),c=e.i(71689),o=e.i(56909),m=e.i(88844),u=e.i(84614),x=e.i(61659),p=e.i(15788),h=e.i(31278),g=e.i(63209),j=e.i(40160),f=e.i(78917),N=e.i(67240),v=e.i(95468),b=e.i(73884),y=e.i(23750),w=e.i(81947),S=e.i(84762);let C="https://api.elecobuy.com";function A({orderId:e}){var A;let k,[R,$]=(0,r.useState)(null),[I,T]=(0,r.useState)(!0),[P,q]=(0,r.useState)(""),[L,D]=(0,r.useState)(!1),[F,B]=(0,r.useState)(!1),[_,O]=(0,r.useState)(!1),[E,z]=(0,r.useState)(""),[V,U]=(0,r.useState)(""),[W,H]=(0,r.useState)([]),[J,M]=(0,r.useState)(""),[G,K]=(0,r.useState)(!1),[X,Y]=(0,r.useState)(!1),[Q,Z]=(0,r.useState)(""),[ee,et]=(0,r.useState)(""),[er,es]=(0,r.useState)(!1),[ea,en]=(0,r.useState)(""),[ei,ed]=(0,r.useState)(!1),el=e=>{if(!e)return"";let t=e/1024/1024;return t>=1?`${t.toFixed(1)} MB`:`${(e/1024).toFixed(0)} KB`},ec=e=>e?e.startsWith("http")?e:`${C}${e}`:"";(0,r.useEffect)(()=>{eo(),em()},[e]);let eo=async()=>{try{T(!0),q("");let t=localStorage.getItem("adminToken");if(!t){q("Not authenticated. Please login again."),T(!1);return}let r=await fetch(`${C}/api/admin/orders/${e}`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!r.ok){let e="Failed to load order";try{e=(await r.json()).message||e}catch{e=r.statusText||`Error ${r.status}`}q(e),T(!1);return}let s=await r.json();if(!s.success){q(s.message||"Failed to load order"),T(!1);return}if($(s.data),z(s.data.status),M(s.data.awbNumber||""),s.data.vendorId&&"object"==typeof s.data.vendorId&&U(s.data.vendorId._id),s.data.createdAt){let e=new Date(s.data.createdAt),t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0"),n=String(e.getHours()).padStart(2,"0"),i=String(e.getMinutes()).padStart(2,"0");et(`${t}-${r}-${a}T${n}:${i}`)}else et("");if(s.data.deliveredAt){let e=new Date(s.data.deliveredAt),t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0"),n=String(e.getHours()).padStart(2,"0"),i=String(e.getMinutes()).padStart(2,"0");en(`${t}-${r}-${a}T${n}:${i}`)}else en("")}catch(e){console.error("Error fetching order:",e),q(e instanceof Error?e.message:"Network error. Please check your connection and try again.")}finally{T(!1)}},em=async()=>{try{let e=localStorage.getItem("adminToken");if(!e)return;let t=await fetch(`${C}/api/vendors?status=approved`,{headers:{Authorization:`Bearer ${e}`}}),r=await t.json();r.success&&H(r.data||[])}catch(e){console.error("Error fetching vendors:",e)}},eu=async()=>{if(R)try{D(!0);let t=localStorage.getItem("adminToken");if(!t)return;if(E!==R.status){let r=await fetch(`${C}/api/admin/orders/${e}/status`,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({status:E})});if(!r.ok){let e=await r.json();throw Error(e.message||"Failed to update status")}}let r="object"==typeof R.vendorId&&R.vendorId?R.vendorId._id:R.vendorId;if(V!==r){let r=await fetch(`${C}/api/admin/orders/${e}/assign-vendor`,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({vendorId:V||null})});if(!r.ok){let e=await r.json();throw Error(e.message||"Failed to assign vendor")}}await eo(),alert("Order updated successfully!")}catch(e){console.error("Error saving order:",e),alert("Failed to save changes")}finally{D(!1)}},ex=async()=>{if(R&&confirm("Cancel this order as admin? If the payment was completed online, a refund will be attempted immediately."))try{B(!0);let t=localStorage.getItem("adminToken");if(!t)return void alert("Not authenticated. Please login again.");let r=await fetch(`${C}/api/admin/orders/${e}/cancel`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({})}),s=await r.json();if(!r.ok||!s.success)return void alert(s.message||"Failed to cancel order");alert(s.message||"Order cancelled successfully"),await eo()}catch(e){console.error("Error cancelling order:",e),alert("Network error. Please try again.")}finally{B(!1)}},ep=async()=>{if(R)try{if(!confirm("Push this order to vendors for acceptance?"))return;O(!0);let t=localStorage.getItem("adminToken");if(!t)return void alert("Not authenticated. Please login again.");let r=await fetch(`${C}/api/admin/orders/${e}/push-to-vendors`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({})}),s=await r.json();if(!r.ok||!s.success)return void alert(s.message||"Failed to push order to vendors");alert("Order pushed to vendors for acceptance"),await eo()}catch(e){console.error("Error pushing order to vendors:",e),alert("Network error. Please try again.")}finally{O(!1)}},eh=async()=>{if(!R||!J.trim())return void alert("Please enter a valid AWB number");let t=J.trim().toUpperCase();if(!/^[A-Z0-9]{9,12}$/.test(t))return void alert("Invalid AWB number format. Expected 9-12 alphanumeric characters (e.g., V01197967 or 7X109986044)");try{K(!0);let r=localStorage.getItem("adminToken");if(!r)return;let s=await fetch(`${C}/api/dtdc/order/${e}/awb`,{method:"PUT",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({awbNumber:t})});if(!s.ok){let e=await s.json();throw Error(e.message||"Failed to update AWB number")}await eo(),alert("AWB number updated successfully!")}catch(e){console.error("Error saving AWB:",e),alert(e instanceof Error?e.message:"Failed to save AWB number")}finally{K(!1)}},eg=async()=>{if(!R||!ee)return void alert("Please select a valid date and time");try{es(!0);let t=localStorage.getItem("adminToken");if(!t)return void alert("Please login again");let r=await fetch(`${C}/api/admin/orders/${e}`,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({createdAt:ee})});if(!r.ok){let e=await r.json();throw Error(e.message||"Failed to update order created date")}await eo(),alert("Order created date updated successfully!")}catch(e){console.error("Error saving createdAt:",e),alert(e instanceof Error?e.message:"Failed to save created date")}finally{es(!1)}},ej=async()=>{if(!R||!ea)return void alert("Please select a valid delivered date and time");try{ed(!0);let t=localStorage.getItem("adminToken");if(!t)return void alert("Please login again");let r=await fetch(`${C}/api/admin/orders/${e}`,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({deliveredAt:ea})});if(!r.ok){let e=await r.json();throw Error(e.message||"Failed to update delivered date")}await eo(),alert("Order delivered date updated successfully!")}catch(e){console.error("Error saving deliveredAt:",e),alert(e instanceof Error?e.message:"Failed to save delivered date")}finally{ed(!1)}},ef=e=>`https://www.dtdc.com/track-your-shipment/?awb=${encodeURIComponent(e)}`,eN=e=>new Date(e).toLocaleDateString("en-IN",{day:"numeric",month:"long",year:"numeric"}),ev=e=>new Date(e).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"}),eb=e=>{if(!e)return"bg-gray-100 text-gray-800 border-gray-200";switch(e.toLowerCase()){case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"booked":return"bg-blue-100 text-blue-800 border-blue-200";case"in_transit":return"bg-purple-100 text-purple-800 border-purple-200";case"out_for_delivery":return"bg-orange-100 text-orange-800 border-orange-200";case"delivered":return"bg-green-100 text-green-800 border-green-200";case"rto":case"failed":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},ey=e=>e?e.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):"Not Set",ew=async()=>{if(R){Y(!0);try{let t=localStorage.getItem("adminToken");if(!t)return void alert("Please login again");let r=await fetch(`${C}/api/admin/orders/${e}/return/accept`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({adminNotes:Q.trim()||void 0})}),s=await r.json();s.success?(Z(""),await eo(),alert("Return request accepted successfully")):alert(s.message||"Failed to accept return request")}catch(e){console.error("Error accepting return request:",e),alert("Network error. Please try again.")}finally{Y(!1)}}},eS=async()=>{if(R){if(!Q.trim())return void alert("Please provide a reason for denying the return request");Y(!0);try{let t=localStorage.getItem("adminToken");if(!t)return void alert("Please login again");let r=await fetch(`${C}/api/admin/orders/${e}/return/deny`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({adminNotes:Q.trim()})}),s=await r.json();s.success?(Z(""),await eo(),alert("Return request denied successfully")):alert(s.message||"Failed to deny return request")}catch(e){console.error("Error denying return request:",e),alert("Network error. Please try again.")}finally{Y(!1)}}};if(I)return(0,t.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,t.jsx)(h.Loader2,{className:"h-8 w-8 animate-spin text-primary"})});if(P||!R)return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(s.default,{href:"/admin/orders",children:(0,t.jsx)(n.Button,{variant:"ghost",size:"icon",children:(0,t.jsx)(c.ArrowLeft,{className:"h-5 w-5"})})}),(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"Order Details"})]}),(0,t.jsx)(a.Card,{className:"border-destructive/50 bg-destructive/10",children:(0,t.jsx)(a.CardContent,{className:"p-6",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(g.AlertCircle,{className:"h-5 w-5 text-destructive"}),(0,t.jsx)("p",{className:"text-destructive",children:P||"Order not found"})]})})})]});let eC=R&&"object"==typeof R.customerId&&null!==R.customerId?{name:R.customerId.name||"N/A",mobile:R.customerId.mobile||"N/A",email:R.customerId.email||"N/A"}:{name:"N/A",mobile:"N/A",email:"N/A"},eA=R&&"object"==typeof R.shippingAddress&&null!==R.shippingAddress?R.shippingAddress:null,ek=R&&R.vendorId&&"object"==typeof R.vendorId&&null!==R.vendorId?R.vendorId:null,eR=(R.status||"").toLowerCase(),e$=!["cancelled","shipped","delivered"].includes(eR)&&!R.awbNumber,eI=(R.cgst||0)+(R.sgst||0)+(R.igst||0),eT=(R.cgst||0)>0||(R.sgst||0)>0,eP=eT?.09*R.shipping:0,eq=eT?.09*R.shipping:0,eL=eT?0:.18*R.shipping,eD=ek?.commission||0,eF=eD/100,eB=R.subtotal*eF,e_=R.subtotal*(1-eF),eO=.02*e_,eE=e_-eO,ez="return_requested"===R.status&&R.returnRequest&&"pending"===R.returnRequest.type,eV=!!R.packingVideo?.url;return(0,t.jsxs)("div",{className:"space-y-6",children:[ez&&(0,t.jsxs)(w.Alert,{className:"border-orange-500 bg-orange-50",children:[(0,t.jsx)(N.RotateCcw,{className:"h-5 w-5 text-orange-600"}),(0,t.jsx)(w.AlertDescription,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold text-lg mb-2",children:"Return Requested"}),(0,t.jsxs)("div",{className:"bg-white p-4 rounded-lg border border-orange-200",children:[(0,t.jsx)(l.Label,{className:"text-sm font-medium text-muted-foreground",children:"Customer Reason:"}),(0,t.jsx)("p",{className:"mt-1 text-sm",children:R.returnRequest?.reason}),R.returnAwbNumber&&(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsx)(l.Label,{className:"text-xs font-medium text-muted-foreground",children:"Return AWB (DTDC):"}),(0,t.jsxs)("div",{className:"mt-1 flex items-center gap-2 flex-wrap",children:[(0,t.jsx)("span",{className:"text-sm",children:R.returnAwbNumber}),R.returnDtdcStatus&&(0,t.jsx)(i.Badge,{className:eb(R.returnDtdcStatus),children:ey(R.returnDtdcStatus)}),(0,t.jsx)("a",{href:ef(R.returnAwbNumber),target:"_blank",rel:"noopener noreferrer",children:(0,t.jsxs)(n.Button,{variant:"outline",size:"sm",children:[(0,t.jsx)(f.ExternalLink,{className:"mr-2 h-4 w-4"}),"Track Return"]})})]})]}),R.returnRequest?.requestedAt&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mt-2",children:["Requested on: ",new Date(R.returnRequest.requestedAt).toLocaleString("en-IN")]}),R.returnRequest?.attachments&&R.returnRequest.attachments.length>0&&(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsx)(l.Label,{className:"text-xs font-medium text-muted-foreground",children:"Customer Uploads:"}),(0,t.jsx)("ul",{className:"mt-1 space-y-1 text-sm",children:R.returnRequest.attachments.map((e,r)=>(0,t.jsxs)("li",{className:"flex items-center justify-between gap-2",children:[(0,t.jsx)("a",{href:ec(e.url),target:"_blank",rel:"noopener noreferrer",className:"text-primary underline",children:e.originalName||e.url?.split("/").pop()}),(0,t.jsxs)("span",{className:"text-xs text-muted-foreground",children:[(e.mimeType?.split("/")?.[0]||"file").toUpperCase()," ",el(e.size)]})]},`${e.url}-${r}`))})]}),eV&&(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsx)(l.Label,{className:"text-xs font-medium text-muted-foreground",children:"Vendor Packing Video:"}),(0,t.jsxs)("div",{className:"mt-2 space-y-2",children:[(0,t.jsx)("video",{controls:!0,preload:"metadata",src:ec(R.packingVideo?.url||""),className:"w-full max-h-[360px] rounded-md border bg-black"}),(0,t.jsx)("a",{href:ec(R.packingVideo?.url||""),target:"_blank",rel:"noopener noreferrer",className:"text-primary underline text-sm",children:"Open video in new tab"})]})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)(l.Label,{htmlFor:"returnAdminNotes",className:"text-sm font-medium",children:["Admin Notes ",R.returnRequest?.type==="pending"&&"(Required for rejection)"]}),(0,t.jsx)(S.Textarea,{id:"returnAdminNotes",placeholder:"Add notes about your decision...",value:Q,onChange:e=>Z(e.target.value),rows:3,className:"mt-2"})]}),(0,t.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,t.jsx)(n.Button,{onClick:ew,disabled:X,className:"flex-1 bg-green-600 hover:bg-green-700",children:X?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Processing..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(v.CheckCircle2,{className:"h-4 w-4 mr-2"}),"Approve Return"]})}),(0,t.jsx)(n.Button,{onClick:eS,disabled:X,variant:"destructive",className:"flex-1",children:X?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Processing..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b.XCircle,{className:"h-4 w-4 mr-2"}),"Reject Return"]})})]})]})})]}),R.returnRequest&&R.returnRequest.type&&"pending"!==R.returnRequest.type&&(0,t.jsxs)(w.Alert,{className:"accepted"===R.returnRequest.type?"border-green-500 bg-green-50":"border-red-500 bg-red-50",children:[(0,t.jsx)(g.AlertCircle,{className:"h-5 w-5"}),(0,t.jsx)(w.AlertDescription,{children:(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"font-semibold mb-2",children:["Return ","accepted"===R.returnRequest.type?"Accepted":"Rejected"]}),"accepted"===R.returnRequest.type&&R.returnAwbNumber&&(0,t.jsxs)("div",{className:"mb-2",children:[(0,t.jsx)("span",{className:"font-medium text-sm",children:"Return AWB (DTDC):"}),(0,t.jsxs)("div",{className:"mt-1 flex items-center gap-2 flex-wrap",children:[(0,t.jsx)("span",{className:"text-sm",children:R.returnAwbNumber}),R.returnDtdcStatus&&(0,t.jsx)(i.Badge,{className:eb(R.returnDtdcStatus),children:ey(R.returnDtdcStatus)}),(0,t.jsx)("a",{href:ef(R.returnAwbNumber),target:"_blank",rel:"noopener noreferrer",children:(0,t.jsxs)(n.Button,{variant:"outline",size:"sm",children:[(0,t.jsx)(f.ExternalLink,{className:"mr-2 h-4 w-4"}),"Track Return"]})})]})]}),R.returnRequest?.reason&&(0,t.jsxs)("div",{className:"mb-2",children:[(0,t.jsx)("span",{className:"font-medium text-sm",children:"Customer Reason:"}),(0,t.jsx)("p",{className:"text-sm mt-1",children:R.returnRequest?.reason})]}),R.returnRequest?.attachments&&R.returnRequest.attachments.length>0&&(0,t.jsxs)("div",{className:"mb-2",children:[(0,t.jsx)("span",{className:"font-medium text-sm",children:"Customer Uploads:"}),(0,t.jsx)("ul",{className:"mt-1 space-y-1 text-sm",children:R.returnRequest.attachments.map((e,r)=>(0,t.jsxs)("li",{className:"flex items-center justify-between gap-2",children:[(0,t.jsx)("a",{href:ec(e.url),target:"_blank",rel:"noopener noreferrer",className:"text-primary underline",children:e.originalName||e.url?.split("/").pop()}),(0,t.jsxs)("span",{className:"text-xs text-muted-foreground",children:[(e.mimeType?.split("/")?.[0]||"file").toUpperCase()," ",el(e.size)]})]},`${e.url}-${r}`))})]}),R.returnRequest?.adminNotes&&(0,t.jsxs)("div",{className:"mb-2",children:[(0,t.jsx)("span",{className:"font-medium text-sm",children:"Admin Notes:"}),(0,t.jsx)("p",{className:"text-sm mt-1",children:R.returnRequest?.adminNotes})]}),R.returnRequest?.reviewedAt&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mt-2",children:["Reviewed on: ",new Date(R.returnRequest.reviewedAt).toLocaleString("en-IN")]}),"accepted"===R.returnRequest.type&&R.returnRequest.refundStatus&&(0,t.jsxs)("div",{className:"mt-2",children:[(0,t.jsx)("span",{className:"font-medium text-sm",children:"Refund Status:"}),(0,t.jsx)(i.Badge,{variant:"completed"===R.returnRequest.refundStatus?"default":"secondary",className:"ml-2",children:R.returnRequest.refundStatus})]})]})})]}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(s.default,{href:"/admin/orders",children:(0,t.jsx)(n.Button,{variant:"ghost",size:"icon",children:(0,t.jsx)(c.ArrowLeft,{className:"h-5 w-5"})})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground",children:R.orderNumber}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["Order placed on ",eN(R.createdAt)," at ",ev(R.createdAt)]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,t.jsx)(i.Badge,{className:`${(e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"confirmed":case"return_picked_up":return"bg-blue-100 text-blue-800";case"processing":return"bg-purple-100 text-purple-800";case"picked_up":return"bg-violet-100 text-violet-800";case"shipped":return"bg-indigo-100 text-indigo-800";case"delivered":case"return_accepted":return"bg-green-100 text-green-800";case"cancelled":case"return_rejected":return"bg-red-100 text-red-800";case"return_requested":return"bg-orange-100 text-orange-800";case"admin_review_required":return"bg-amber-100 text-amber-800";default:return"bg-gray-100 text-gray-800"}})(eR)} w-fit capitalize`,children:eR.replace(/_/g," ")}),R.awbNumber&&R.dtdcStatus&&(0,t.jsxs)(i.Badge,{className:eb(R.dtdcStatus),children:["DTDC: ",ey(R.dtdcStatus)]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsxs)(a.Card,{children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsxs)(a.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(m.Package,{className:"h-5 w-5"}),"Packing Verification"]})}),(0,t.jsx)(a.CardContent,{className:"space-y-3",children:eV?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("video",{controls:!0,preload:"metadata",src:ec(R.packingVideo?.url||""),className:"w-full max-h-[360px] rounded-md border bg-black"}),(0,t.jsxs)("div",{className:"text-xs text-muted-foreground space-y-1",children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"font-medium text-foreground",children:"File:"})," ",R.packingVideo?.originalName||(R.packingVideo?.url||"").split("/").pop()]}),R.packingVideo?.mimeType&&(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"font-medium text-foreground",children:"Type:"})," ",R.packingVideo.mimeType]}),"number"==typeof R.packingVideo?.size&&(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"font-medium text-foreground",children:"Size:"})," ",el(R.packingVideo.size)]}),R.packingVideo?.uploadedAt&&(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"font-medium text-foreground",children:"Uploaded:"})," ",new Date(R.packingVideo.uploadedAt).toLocaleString("en-IN")]}),(0,t.jsx)("a",{href:ec(R.packingVideo?.url||""),target:"_blank",rel:"noopener noreferrer",className:"text-primary underline",children:"Open video in new tab"})]})]}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"No packing video uploaded by vendor yet."})})]}),(0,t.jsxs)(a.Card,{children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsxs)(a.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(u.User,{className:"h-5 w-5"}),"Customer Information"]})}),(0,t.jsxs)(a.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(l.Label,{children:"Customer Name"}),(0,t.jsx)("p",{className:"mt-1.5 text-sm font-medium",children:eC.name})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(l.Label,{children:"Contact Number"}),(0,t.jsx)("p",{className:"mt-1.5 text-sm font-medium",children:eC.mobile})]}),"N/A"!==eC.email&&(0,t.jsxs)("div",{children:[(0,t.jsx)(l.Label,{children:"Email"}),(0,t.jsx)("p",{className:"mt-1.5 text-sm font-medium",children:eC.email})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(l.Label,{children:"Delivery Address"}),eA?(0,t.jsxs)("p",{className:"mt-1.5 text-sm",children:[eA.firstName," ",eA.lastName,(0,t.jsx)("br",{}),eA.address1,eA.address2&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("br",{}),eA.address2]}),(0,t.jsx)("br",{}),eA.city,", ",eA.state," - ",eA.postcode,(0,t.jsx)("br",{}),"Phone: ",eA.phone]}):(0,t.jsx)("p",{className:"mt-1.5 text-sm text-muted-foreground",children:"No address available"})]})]})]}),(0,t.jsxs)(a.Card,{children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsxs)(a.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(m.Package,{className:"h-5 w-5"}),"Product Information"]})}),(0,t.jsx)(a.CardContent,{className:"space-y-4",children:R.items.map((e,r)=>{let s=e.productId;return(0,t.jsx)("div",{className:"border-b border-border pb-4 last:border-0 last:pb-0",children:(0,t.jsxs)("div",{className:"flex gap-3",children:[s?.images&&s.images.length>0?(0,t.jsx)("img",{src:s.images[0].startsWith("http")?s.images[0]:`${C}${s.images[0]}`,alt:e.name,className:"h-16 w-16 rounded-lg object-cover bg-muted"}):(0,t.jsx)("div",{className:"h-16 w-16 rounded-lg bg-muted flex items-center justify-center",children:(0,t.jsx)(m.Package,{className:"h-6 w-6 text-muted-foreground"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"font-medium",children:e.name}),s?.brand&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Brand: ",s.brand]}),s?.sku&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["SKU: ",s.sku]}),(0,t.jsxs)("div",{className:"flex justify-between mt-1",children:[(0,t.jsxs)("span",{className:"text-sm",children:["Qty: ",e.quantity]}),(0,t.jsxs)("span",{className:"text-sm font-medium",children:["₹",e.price.toLocaleString("en-IN")]})]})]})]})},r)})})]}),(0,t.jsxs)(a.Card,{children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsxs)(a.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(x.CreditCard,{className:"h-5 w-5"}),"Payment Information"]})}),(0,t.jsxs)(a.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(l.Label,{children:"Payment Method"}),(0,t.jsx)("p",{className:"mt-1.5 text-sm font-medium capitalize",children:"cod"===R.paymentMethod?"Cash on Delivery":R.paymentMethod})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(l.Label,{children:"Payment Status"}),(0,t.jsx)(i.Badge,{className:`mt-1.5 capitalize ${"paid"===R.paymentStatus?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:R.paymentStatus})]}),R.refundStatus&&(0,t.jsxs)("div",{children:[(0,t.jsx)(l.Label,{children:"Refund Status"}),(0,t.jsxs)("div",{className:"mt-1.5 space-y-1",children:[(0,t.jsx)(i.Badge,{className:(e=>{if(!e)return"bg-gray-100 text-gray-800 border-gray-200";switch(e.toLowerCase()){case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"processing":return"bg-blue-100 text-blue-800 border-blue-200";case"completed":return"bg-green-100 text-green-800 border-green-200";case"failed":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}})(R.refundStatus),children:(A=R.refundStatus)?A.charAt(0).toUpperCase()+A.slice(1):"N/A"}),R.refundTransactionId&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["Transaction ID: ",R.refundTransactionId]})]})]}),(0,t.jsxs)("div",{className:"border-t pt-4 space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Subtotal"}),(0,t.jsxs)("span",{children:["₹",R.subtotal.toLocaleString("en-IN")]})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Shipping"}),(0,t.jsxs)("span",{children:["₹",R.shipping.toLocaleString("en-IN")]})]}),(0,t.jsxs)("div",{className:"flex justify-between text-xs text-muted-foreground",children:[(0,t.jsxs)("span",{children:["Shipping GST ",eT?"(CGST @ 9% + SGST @ 9%)":"(IGST @ 18%)"]}),(0,t.jsxs)("span",{children:["₹",eT?(eP+eq).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2}):eL.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"GST on Order"}),(0,t.jsxs)("span",{children:["₹",eI.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),(0,t.jsxs)("div",{className:"flex justify-between font-bold text-lg pt-2 border-t",children:[(0,t.jsx)("span",{children:"Total"}),(0,t.jsxs)("span",{className:"text-green-600",children:["₹",R.total.toLocaleString("en-IN")]})]})]})]})]}),ek&&(0,t.jsxs)(a.Card,{children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsxs)(a.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(x.CreditCard,{className:"h-5 w-5"}),"Vendor Payout"]})}),(0,t.jsxs)(a.CardContent,{className:"space-y-2 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Product Total"}),(0,t.jsxs)("span",{children:["₹",R.subtotal.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsxs)("span",{className:"text-muted-foreground",children:["Platform Commission (",eD,"%)"]}),(0,t.jsxs)("span",{children:["- ₹",eB.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),(0,t.jsxs)("div",{className:"flex justify-between font-medium pt-1",children:[(0,t.jsx)("span",{children:"Payout before Gateway"}),(0,t.jsxs)("span",{children:["₹",e_.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Payment Gateway Charges (~2% of payout before gateway)"}),(0,t.jsxs)("span",{children:["- ₹",eO.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),(0,t.jsxs)("div",{className:"flex justify-between font-bold text-base pt-2 border-t",children:[(0,t.jsx)("span",{children:"Net Payout to Vendor"}),(0,t.jsxs)("span",{children:["₹",eE.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]}),(0,t.jsxs)(a.Card,{children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsxs)(a.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(p.Truck,{className:"h-5 w-5"}),"Shipping Information"]})}),(0,t.jsxs)(a.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(l.Label,{htmlFor:"assignedSeller",children:"Assigned Vendor"}),(0,t.jsxs)(d.Select,{value:V,onValueChange:U,children:[(0,t.jsx)(d.SelectTrigger,{id:"assignedSeller",className:"mt-1.5",children:(0,t.jsx)(d.SelectValue,{placeholder:"Select vendor"})}),(0,t.jsx)(d.SelectContent,{children:W.map(e=>(0,t.jsx)(d.SelectItem,{value:e._id,children:e.name},e._id))})]}),ek&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["Currently: ",ek.name,ek.address&&` (${ek.address.city}, ${ek.address.state})`]}),(0,t.jsxs)("div",{className:"mt-2",children:[(0,t.jsx)(n.Button,{variant:"outline",onClick:ep,disabled:_||!!R.awbNumber||"paid"!==R.paymentStatus,className:"w-full",children:_?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Pushing..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(N.RotateCcw,{className:"mr-2 h-4 w-4"}),"Push to Vendors for Acceptance"]})}),("paid"!==R.paymentStatus||!!R.awbNumber)&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Push is available only for paid, unshipped orders."})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(l.Label,{htmlFor:"orderStatus",children:"Order Status"}),(0,t.jsxs)(d.Select,{value:E,onValueChange:z,children:[(0,t.jsx)(d.SelectTrigger,{id:"orderStatus",className:"mt-1.5",children:(0,t.jsx)(d.SelectValue,{})}),(0,t.jsxs)(d.SelectContent,{children:[(0,t.jsx)(d.SelectItem,{value:"pending",children:"Pending"}),(0,t.jsx)(d.SelectItem,{value:"confirmed",children:"Confirmed"}),(0,t.jsx)(d.SelectItem,{value:"processing",children:"Processing"}),(0,t.jsx)(d.SelectItem,{value:"shipped",children:"Shipped"}),(0,t.jsx)(d.SelectItem,{value:"delivered",children:"Delivered"}),(0,t.jsx)(d.SelectItem,{value:"cancelled",children:"Cancelled"}),(0,t.jsx)(d.SelectItem,{value:"return_requested",children:"Return Requested"}),(0,t.jsx)(d.SelectItem,{value:"return_accepted",children:"Return Accepted"}),(0,t.jsx)(d.SelectItem,{value:"return_rejected",children:"Return Rejected"}),(0,t.jsx)(d.SelectItem,{value:"return_picked_up",children:"Return packed up"}),(0,t.jsx)(d.SelectItem,{value:"admin_review_required",children:"Admin Review Required"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(l.Label,{htmlFor:"awbNumber",children:"AWB Number (DTDC)"}),(0,t.jsxs)("div",{className:"mt-1.5 flex gap-2",children:[(0,t.jsx)(y.Input,{id:"awbNumber",placeholder:"e.g., V01197967",value:J,onChange:e=>M(e.target.value.toUpperCase()),maxLength:12,className:"flex-1"}),(0,t.jsx)(n.Button,{onClick:eh,disabled:G||!J.trim(),size:"sm",children:G?(0,t.jsx)(h.Loader2,{className:"h-4 w-4 animate-spin"}):"Save"})]}),R.awbNumber&&(0,t.jsxs)("div",{className:"mt-2 space-y-2",children:[(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Current: ",R.awbNumber]}),R.dtdcStatus&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(l.Label,{className:"text-xs",children:"DTDC Status:"}),(0,t.jsx)(i.Badge,{className:eb(R.dtdcStatus),children:ey(R.dtdcStatus)})]}),(0,t.jsx)("a",{href:ef(R.awbNumber),target:"_blank",rel:"noopener noreferrer",className:"w-full",children:(0,t.jsxs)(n.Button,{variant:"outline",size:"sm",className:"w-full",children:[(0,t.jsx)(f.ExternalLink,{className:"mr-2 h-4 w-4"}),"Track on DTDC Website"]})})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(l.Label,{htmlFor:"createdAt",children:"Order Created At"}),(0,t.jsxs)("div",{className:"mt-1.5 flex gap-2",children:[(0,t.jsx)(y.Input,{id:"createdAt",type:"datetime-local",value:ee,onChange:e=>et(e.target.value),className:"flex-1"}),(0,t.jsx)(n.Button,{onClick:eg,disabled:er||!ee,size:"sm",children:er?(0,t.jsx)(h.Loader2,{className:"h-4 w-4 animate-spin"}):"Save"})]}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["Current: ",eN(R.createdAt)," at ",ev(R.createdAt)]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(l.Label,{htmlFor:"deliveredAt",children:"Delivered At"}),(0,t.jsxs)("div",{className:"mt-1.5 flex gap-2",children:[(0,t.jsx)(y.Input,{id:"deliveredAt",type:"datetime-local",value:ea,onChange:e=>en(e.target.value),className:"flex-1"}),(0,t.jsx)(n.Button,{onClick:ej,disabled:ei||!ea,size:"sm",children:ei?(0,t.jsx)(h.Loader2,{className:"h-4 w-4 animate-spin"}):"Save"})]}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["Current:"," ",R.deliveredAt?`${eN(R.deliveredAt)} at ${ev(R.deliveredAt)}`:"Not marked as delivered"]})]})]})]})]})]}),(0,t.jsxs)(a.Card,{children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsx)(a.CardTitle,{children:"Order Timeline"})}),(0,t.jsx)(a.CardContent,{children:(0,t.jsx)("div",{className:"relative space-y-6 sm:space-y-8",children:(k=(e=>{let t=[],r=e.status.toLowerCase(),s=(e=>{let t,r=(e.status||"").toLowerCase();if("cancelled"===r||r.startsWith("return_"))return r;if("admin_review_required"===r)return"processing";let s=(t=String(e.dtdcTrackingData?.statusText||"").toLowerCase())?t.includes("delivered")||t.includes("delivery completed")?"delivered":t.includes("out for delivery")||t.includes("in transit")||t.includes("dispatched")||t.includes("arrived at")?"shipped":t.includes("packed up")||t.includes("pickup completed")||t.includes("pickup done")?"picked_up":null:null;return s||r})(e);if("cancelled"===r)return t.push({status:"Order Placed",date:`${eN(e.createdAt)} at ${ev(e.createdAt)}`,completed:!0}),t.push({status:"Cancelled",date:`${eN(e.updatedAt)} at ${ev(e.updatedAt)}`,completed:!0,isCancelled:!0}),t;if(e.returnRequest&&e.returnRequest.type){let s=e.returnRequest.type,a="accepted"===s||"return_accepted"===r,n="denied"===s||"return_rejected"===r,i="return_picked_up"===r,d="completed"===e.refundStatus||"completed"===e.returnRequest.refundStatus||"refunded"===e.paymentStatus,l=["pending","confirmed","processing","shipped","delivered"],c=l.indexOf("delivered");return l.forEach((r,s)=>{let a="Completed";0===s?a=`${eN(e.createdAt)} at ${ev(e.createdAt)}`:s===c&&e.deliveredAt&&(a=`${eN(e.deliveredAt)} at ${ev(e.deliveredAt)}`),t.push({status:"pending"===r?"Order Placed":"confirmed"===r?"Order Confirmed":"processing"===r?"Processing":"shipped"===r?"Shipped":"Delivered",date:a,completed:!0})}),t.push({status:"Return Requested",date:e.returnRequest.requestedAt?`${eN(e.returnRequest.requestedAt)} at ${ev(e.returnRequest.requestedAt)}`:"Pending",completed:!0}),a?(t.push({status:"Return Accepted",date:e.returnRequest.reviewedAt?`${eN(e.returnRequest.reviewedAt)} at ${ev(e.returnRequest.reviewedAt)}`:"Pending",completed:!0}),i?(t.push({status:"packed up",date:`${eN(e.updatedAt)} at ${ev(e.updatedAt)}`,completed:!0}),d?t.push({status:"Refunded Successfully",date:"Completed",completed:!0}):t.push({status:"Refund Pending",date:"In progress",completed:!1})):t.push({status:"Return Pickup Pending",date:"Pending",completed:!1})):n?t.push({status:"Return Rejected",date:e.returnRequest.reviewedAt?`${eN(e.returnRequest.reviewedAt)} at ${ev(e.returnRequest.reviewedAt)}`:"Pending",completed:!0,isRejected:!0}):t.push({status:"Return Under Review",date:"Pending",completed:!1}),t}let a=["pending","confirmed","processing","picked_up","shipped","delivered"],n=Math.max(a.indexOf(s),a.indexOf(r));return a.forEach((s,a)=>{let i=a<=n,d="";d=i?"pending"===s?`${eN(e.createdAt)} at ${ev(e.createdAt)}`:"delivered"===s&&"delivered"===r&&e.deliveredAt?`${eN(e.deliveredAt)} at ${ev(e.deliveredAt)}`:a===n?"In progress":"Completed":"Pending",t.push({status:"pending"===s?"Order Placed":"confirmed"===s?"Order Confirmed":"processing"===s?"Processing":"picked_up"===s?"packed up":"shipped"===s?"Shipped":"Delivered",date:d,completed:i})}),t})(R)).map((e,r)=>{let s=e.isCancelled,a=e.isRejected,n=s||a?"bg-red-500 text-white":e.completed?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground";return(0,t.jsxs)("div",{className:"relative flex gap-3 sm:gap-4",children:[(0,t.jsxs)("div",{className:"relative flex flex-col items-center",children:[(0,t.jsx)("div",{className:`flex h-8 w-8 sm:h-10 sm:w-10 items-center justify-center rounded-full ${n}`,children:e.completed?s||a?(0,t.jsx)(b.XCircle,{className:"h-4 w-4 sm:h-5 sm:w-5"}):(0,t.jsx)(v.CheckCircle2,{className:"h-4 w-4 sm:h-5 sm:w-5"}):(0,t.jsx)("div",{className:"h-2 w-2 sm:h-3 sm:w-3 rounded-full bg-current"})}),r<k.length-1&&(0,t.jsx)("div",{className:`absolute top-10 h-full w-0.5 ${s||a?"bg-red-500":e.completed?"bg-primary":"bg-muted"}`})]}),(0,t.jsxs)("div",{className:"flex-1 pb-6 sm:pb-8",children:[(0,t.jsx)("p",{className:`font-semibold text-sm sm:text-base ${s||a?"text-red-600 dark:text-red-400":e.completed?"":"text-muted-foreground"}`,children:e.status}),(0,t.jsx)("p",{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:e.date})]})]},r)})})})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center gap-3",children:[(0,t.jsxs)(n.Button,{variant:"outline",onClick:async()=>{try{let t=localStorage.getItem("adminToken");if(!t)return void alert("Please login to download invoice");let r=await fetch(`${C}/api/invoices/${e}/download/admin`,{headers:{Authorization:`Bearer ${t}`}});if(!r.ok)throw Error("Failed to download invoice");let s=await r.blob(),a=window.URL.createObjectURL(s),n=document.createElement("a");n.href=a,n.download=`Invoice_${R?.invoiceNumber||R?.orderNumber||"invoice"}.pdf`,document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(a),document.body.removeChild(n)}catch(e){console.error("Error downloading invoice:",e),alert("Failed to download invoice. Please try again.")}},children:[(0,t.jsx)(j.Download,{className:"h-4 w-4 mr-2"}),"Download Invoice"]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[e$&&(0,t.jsx)(n.Button,{variant:"destructive",onClick:ex,disabled:F,title:"Cancel order as admin and attempt refund immediately",children:F?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Cancelling..."]}):"Cancel Order"}),(0,t.jsx)(s.default,{href:"/admin/orders",children:(0,t.jsx)(n.Button,{variant:"outline",children:"Cancel"})}),(0,t.jsx)(n.Button,{className:"gap-2",onClick:eu,disabled:L,children:L?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h.Loader2,{className:"h-4 w-4 animate-spin"}),"Saving..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.Save,{className:"h-4 w-4"}),"Save Changes"]})})]})]})]})}e.s(["AdminOrderDetail",()=>A])}]);